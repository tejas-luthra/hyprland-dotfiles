(self.webpackChunk=self.webpackChunk||[]).push([[1634],{64078:(e,t,n)=>{n.d(t,{X:()=>P});var i,o=n(59312),s=n(27378),a=n(57050),r=n(19962),l=n(5114),d=n(44060),c=n(67424),h=n(89894),u=n(32096),p=n(40327),m=n(5739),g=n(98403),f=n(49708),b=n(85985),_=n(41398),v=n(24209),w=n(17343),y=n(38194),E=n(598),C=n(50628),x=n(25781),I=n(83078),k=n(18625);!function(e){var t="scrollaction";e.emit=function(e){return self.dispatchEvent(new CustomEvent(t,{detail:e}))},e.observe=k.P((function(){return f.R(self,t)}))}(i||(i={}));var S=n(42103),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subs=[],t._outOfTarget=function(e){return function(t){return!r.UL.hasPoint(t.getBoundingClientRect(),e)}},t}return(0,o.ZT)(t,e),t.prototype.componentDidMount=function(){this._listenTooltipAppearance()},t.prototype.componentWillUnmount=function(){this._subs.forEach((function(e){return e.unsubscribe()})),this._subs=[],this.context.hide()},t.prototype.render=function(){return s.createElement(m.F.div,{"data-role":"tooltip"},this.context.state.view(this.props.children))},t.prototype._listenTooltipAppearance=function(){var e=this,t=f.R(document,"keydown").pipe(b.h((function(e){return e.keyCode===x.R.ESC_CODE}))),n=f.R(document,"mousedown").pipe(_.M(this.context.state),b.h((function(t){var n=t[0],i=t[1];return(0,p.pipe)(i,l.map((function(e){return e.target})),l.filter((function(){return r.pK(n.target)})),I.wo(e._outOfTarget({x:n.clientX,y:n.clientY})))}))),o=v.T(t,n,f.R(document,"scroll"),i.observe.pipe(b.h((function(e){return"show"===e.detail})))).pipe(w.h(g.PU),y.B());this._subs=[this.context.hasContent.pipe(b.h(Boolean),E.c(o.pipe(C.P()))).subscribe(this.context.hide),this.context.hasContent.pipe(b.h(Boolean),E.c(v.T(g.gw(!0,500),o.pipe(w.h(!1))).pipe(C.P())),b.h(Boolean)).subscribe(this.context.show)]},t.contextType=S.G.Context,t}(s.Component),P=function(){return s.createElement(M,null,(0,a.ls)(l.map((function(e){return s.createElement(c.t.ByAbsoluteRect,(0,o.pi)({rect:r.UL.fromEl(e.target),className:H.container},c.t.Alignment.toSelector(e.alignment),{withPin:!0}),s.createElement("div",{className:H.content},e.content))})),l.toNullable))},N={position:"fixed",zIndex:u.DY,pointerEvents:"none",$nest:{"@media print":{visibility:"hidden"}}},A={padding:"".concat(h.ux.rem(.25)," ").concat(h.ux.rem(1)),borderRadius:h.ux.rem(u.fx),background:d.Il.BackgroundTooltip,color:d.Il.CoreNeutral1,textAlign:"center",whiteSpace:"nowrap",letterSpacing:h.ux.px(.25),fontSize:h.ux.rem(.75),lineHeight:h.ux.rem(1)},H=h.ux.stylesheet({container:[N],content:[A]})},47849:(e,t,n)=>{n.d(t,{C:()=>i,L:()=>y});var i,o=n(57050),s=n(74850),a=n(11407),r=n(62337),l=n(28728),d=n(15555),c=n(13718),h=n(19751),u=n(77176),p=n(66310),m=n(85985),g=n(17343),f=n(2834),b=n(24209),_=n(49708),v=n(50628),w=n(73975);!function(e){e.getEq=function(){return w.f7(((e,t)=>e&&t?e.annotation.id===t.annotation.id:e===t))}}(i||(i={}));class y{constructor(e,t=s.Y.create(y.name)){this._options=e,this._log=t,this._rawHighlightedAnnotation=()=>this._options.mouseData.pipe(c.U(a.S.hz30),h.skipBy(l.Z.eq),u.U((({client:e,offset:t})=>{if(e&&t&&function(e,t){var n;let i=t.ownerDocument.elementFromPoint(e.left,e.top);(null===(n=null==i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint)&&(i=i.shadowRoot.elementFromPoint(e.left,e.top));return t.contains(i)}(e,this._options.textNode)){const e=this._options.highlightGeometry.geometry.get();return Array.from(e.keys()).reduce(((n,i)=>{const o=e.get(i);if(o){const e=o.rects&&(null===o.meta.highlightDisplayFormat||d.jk.isInteractable(o.meta.highlightDisplayFormat))&&o.rects.find((e=>r.UL.contains(t,e)));if(e)return{annotation:o.meta.annotation,activeHighlightId:o.meta.highlightId,activeHighlightRect:e,highlightIds:[]}}return n}),null)}return null})),h.skipBy(i.getEq()),u.U((e=>{if(!e)return null;const t=this._options.highlightGeometry.geometry.get(),n=[];return t.forEach(((t,i)=>{t.meta.annotation.id===e.annotation.id&&n.push(i)})),{...e,highlightIds:n}}))),this._switchByDisplayedCard=()=>(0,o.ls)(p.w((e=>this._options.cardController.cardHovered.pipe(u.U((t=>t?this._options.getCurrentCardAnnotationState():e))))),h.skipBy(i.getEq())),this._offByUpdatedGeometry=e=>this._options.highlightGeometry.geometry.pipe(u.U((t=>e&&t.has(e.activeHighlightId)?e:null)),m.h((e=>null===e)),g.h(null),f.b((e=>this._log.trace("OffByUpdatedGeometry",e)))),this._offByTextPositionChange=()=>b.T(this._options.textNodeLayout.rect.changes.pipe(f.b((()=>this._log.trace("Text field position, size has been changed")))),this._options.textNodeLayout.scroll.changes.pipe(f.b((()=>this._log.trace("Text field scroll has been changed")))),_.R(self,"scroll").pipe(f.b((()=>this._log.trace("Window scroll detected"))))).pipe(v.P(),g.h(null))}getActiveAnnotation(){throw new Error("Not implemented")}getHighlightedAnnotation(){throw new Error("Not implemented")}}},55421:(e,t,n)=>{n.d(t,{_:()=>w});var i,o=n(17771),s=n(57050),a=n(48044),r=n(19019),l=n(52965),d=n(66319),c=n(75420),h=n(85985),u=n(77176),p=n(93508),m=n(16118),g=n(73975),f=n(71249),b=n(5114),_=n(43675),v=n(92843);function w(e){const t=Date.now();return d.x.create(e,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["contenteditable"]}).pipe(h.h((e=>e.some((e=>"attributes"==e.type&&(0,c.Re)(e.target)?e.target.matches(l.kO):Array.from(e.addedNodes).filter(c.Re).some((e=>e.matches(l.kO)||!!e.querySelector(l.kO)))||Array.from(e.removedNodes).filter(c.Re).some((e=>e.querySelector(l.kO))))))),u.U((t=>Array.from(e.querySelectorAll(l.kO))))).pipe(p.O(Array.from(e.querySelectorAll(l.kO))),u.U((e=>(0,s.zG)(e,f.UI((e=>(0,s.zG)(b.fromNullable(e.closest(l.e8)),b.chain((n=>{var i;return o.Y(b.option)({formEl:b.fromNullable(null===(i=n.closest(l.KC))||void 0===i?void 0:i.querySelector(l.ZA)),buttonEl:b.fromNullable(n.querySelector(l.DM)),messageId:(0,s.zG)(b.fromNullable(e.closest(l.n4)),b.chain(r.Su)),initTime:b.some(t),startTime:b.some(Date.now()-t)})}))))),f.oA,f.u4(new Map,((e,t)=>(0,s.zG)(e,a.ZQ(g.w4)(t.formEl,t))))))),m.G(),u.U((([e,t])=>(0,s.zG)(_.yi(i.eq)(e,t),v.v.reduce({forms:new Map(Array.from(t.values()).map((e=>[e.messageId,e]))),added:new Set,updated:new Set,removed:new Set},((e,t)=>({...e,removed:e.removed.add(t.messageId)})),((e,t,n)=>({...e,updated:e.updated.add(n.messageId)})),((e,t)=>({...e,added:e.added.add(t.messageId)})))))))}!function(e){e.eq=g.w4}(i||(i={}))},44126:(e,t,n)=>{n.d(t,{c:()=>_});var i=n(57050),o=n(90361),s=n(32952),a=n(71032),r=n(12126),l=n(85321),d=n(77176),c=n(85985),h=n(23063),u=n(17343),p=n(2834),m=n(77150),g=n(78674),f=n(5114),b=n(70631);function _(e,t=0){return n=>{const _=new s.xQ;return(0,i.zG)(n,a.b((e=>r.D(Array.from(e)))),l.zg((t=>e.pipe(d.U((e=>(0,i.zG)(f.fromNullable(e.expandedMessages.get(t)),f.fold(i.jv,b.d6)))),c.h(o.fQ),h.q(1),u.h(t)))),p.b((()=>_.next())),m.R((()=>_.pipe(g.b(t)))),d.U((e=>new Set(e))),c.h((e=>e.size>0)))}}},49847:(e,t,n)=>{n.r(t),n.d(t,{createReaderGmailV1ThreadIntegration:()=>_t});var i=n(57050),o=n(29511),s=n(74850),a=n(19751),r=n(49708),l=n(41398),d=n(77176),c=n(66310),h=n(24209),u=n(2834),p=n(50628),m=n(93508),g=n(76974),f=n(2844),b=n(47849);class _ extends b.L{constructor(e,t=s.Y.create(_.name)){super(e,t)}getActiveAnnotation(){var e;return r.R((null===(e=this._options.textNode.ownerDocument)||void 0===e?void 0:e.defaultView)||this._options.textNode,"click").pipe(l.M(this._rawHighlightedAnnotation().pipe(this._switchByDisplayedCard())),d.U((([e,t])=>t)),c.w((e=>e?h.T(this._offByUpdatedGeometry(e),this._offByTextPositionChange()).pipe(u.b((()=>this._log.trace("Active state was overriden by text or geometry change"))),p.P(),m.O(e)):g.of(null))),a.skipBy(b.C.getEq()))}getHighlightedAnnotation(){return f.aj([this._rawHighlightedAnnotation(),this.getActiveAnnotation().pipe(m.O(null))]).pipe(d.U((([e,t])=>null!==t?t:e)))}}var v=n(27378),w=n(52513),y=n(41263),E=n(22679),C=n(34311),x=n(41703),I=n(28043),k=n(5739),S=n(97565),M=n(22232),P=n(12187),N=n(41538);const A=({heightOffset:e=0,hovered:t=!1,annotation:n,rects:i,id:o})=>v.createElement(v.Fragment,null,i.map(((s,a)=>{const r=i.length>1?`${o}-${a}`:o;return v.createElement("div",{key:r,"data-key":r,"data-grammarly-part":"highlight",style:U({...s,height:Math.max(0,s.height+e)},t),className:N.highlight},v.createElement("div",{className:H(n,t)}))})));function H(e,t){switch(e.kind){case S.j.Kind.readerDebugAnnotation:return(0,P.Sh)(N.background,N.debug).className;case S.j.Kind.readerMainPoint:case S.j.Kind.readerFollowUp:return(0,P.Sh)(N.background,t&&N.hovered).className;default:(0,M.vE)(e.kind)}}function U(e,t){const n=.1*e.height;return t?{top:e.top-n,left:e.left-n,width:e.width+2*n,height:e.height+2*n}:e}const F=({highlights:e,getHoverState:t})=>v.createElement(x.Y,{key:"reader-highlights",highlightHeightOffset:0,highlights:e.geometry.view((e=>Array.from(e.values()))),getHoverState:t,highlightRenderer:(e,t,n)=>v.createElement(k.F.Fragment,null,t.pipe(m.O(C.pc.none),I.x(),d.U((t=>v.createElement(A,{key:e.meta.highlightId,id:e.meta.highlightId,rects:e.rects,heightOffset:n,hovered:t!==C.pc.none,annotation:e.meta.annotation})))))});var z=n(87965),T=n(50663),L=n(48189),R=n(49468);class G{constructor(e,t,n,i){this._layout=e,this._highlights=t,this._annotationCards=n,this._getHoveredStateBehavior=i,this._getHighlightsContainer=e=>v.createElement(k.F.div,{style:this._layout.textNode.scrollSize.behavior.pipe(d.U((e=>({height:e.height,width:e.width}))))},e),this.highlights=()=>this._getHighlightsContainer(v.createElement(y.L,{chunkName:"readerGmailV1ThreadIntegration"},v.createElement(F,{highlights:this._highlights,getHoverState:e=>this._getHoveredStateBehavior(e)}))),this.outerElements=()=>{const e=this._annotationCards;return v.createElement(y.L,{chunkName:"readerGmailV1ThreadIntegration"},v.createElement(R.o,{style:{zIndex:E.op,position:"absolute",top:0,left:0,width:"100%"}},v.createElement(z.p,null,v.createElement(w.L,null),v.createElement(k.F.Fragment,null,e),v.createElement(T.G,null),v.createElement(L.p,{regular:!0,bold:!0}))))}}}var D,j=n(22667),B=n(16027),O=n(71359),K=n(64757),V=n(10870);!function(e){e.Primary=({onClick:e,title:t,ariaLabel:n,children:i,name:o,compact:s,disabled:a,theme:r})=>v.createElement(K.zx.Primary,{...(0,P.Sh)(V.button,"dark"===r?V.dark:void 0,s?V.noPadding:void 0),onClick:e,name:o,title:t,ariaLabel:n,disabled:a},i),e.Secondary=({onClick:e,title:t,ariaLabel:n,children:i,name:o,compact:s,disabled:a,theme:r})=>v.createElement(K.zx.Ghost,{...(0,P.Sh)(V.button,V.secondary,"dark"===r?V.dark:void 0,s?V.noPadding:void 0),onClick:e,name:o,title:t,ariaLabel:n,disabled:a},i),e.Tertiary=({onClick:e,title:t,ariaLabel:n,children:i,name:o,compact:s,disabled:a,theme:r})=>v.createElement(K.zx.Tertiary,{...(0,P.Sh)(V.button,V.tertiary,"dark"===r?V.dark:void 0,s?V.noPadding:void 0),onClick:e,name:o,title:t,ariaLabel:n,disabled:a},i)}(D||(D={}));const Z={followUps:{buttonTitle:{singular:"Follow-up",plural:"Follow-ups"}},keyPoints:{buttonTitle:{singular:"Key point",plural:"Key points"}},all:{buttonTitle:"All"},hintPopup:{title:"Summarize your message",content:"Grammarly can automatically summarize key points to help you reply faster",okButton:"Got it",moreButton:"Learn more"},settingsMenu:{hide:"Hide email recap",about:"About email recap",feedback:"Give feedback",disable:"Disable email recap"}};var q,Y,Q=n(85985);!function(e){let t;!function(e){e.toggleSettingsMenu="toggleSettingsMenu",e.setCompactPanelMoreDataPopup="setCompactPanelMoreDataPopup",e.setHintPopup="setHintPopup",e.toggleInlineHighlights="toggleInlineHighlights",e.hideCompactPanel="hideCompactPanel",e.requestAbout="requestAbout",e.requestFeedback="requestFeedback",e.disable="disable"}(t=e.Kind||(e.Kind={})),e.is=function(e){return t=>t.kind===e}}(q||(q={})),function(e){e.ofType=function(e){return Q.h(q.is(e))}}(Y||(Y={}));var $=n(2005),W=n(61922),J=n(5114),X=n(3595);const ee=({onClick:e,title:t,ariaLabel:n,children:i,name:o,compact:s})=>v.createElement(K.zx.Tertiary,{...(0,P.Sh)(X.button,s?X.noPadding:void 0),onClick:e,name:o,title:t,ariaLabel:n},i);var te=n(38573);const ne=()=>v.createElement("div",{className:te.hint},v.createElement("h1",{className:te.header},Z.hintPopup.title),v.createElement("div",{className:te.content},v.createElement("div",null,Z.hintPopup.content)),v.createElement("div",{className:te.buttons},v.createElement(D.Primary,{name:"ok",theme:"dark"},Z.hintPopup.okButton),v.createElement(D.Tertiary,{name:"learnMore",theme:"dark"},Z.hintPopup.moreButton))),ie=({className:e})=>v.createElement(W.a1,{className:e,width:"53",height:"28",viewBox:"0 0 53 28"},v.createElement("rect",{y:"10",width:"37",height:"18",rx:"9",fill:"url(#paint0_linear_1156_21646)",stroke:"none"}),v.createElement("path",{d:"M12.2555 14.2727H10.4189V19.7614H10.3422L6.57511 14.2727H4.95579V23H6.80096V17.5071H6.86488L10.6618 23H12.2555V14.2727ZM13.78 23H19.6777V21.4787H15.6252V19.3949H19.3581V17.8736H15.6252V15.794H19.6607V14.2727H13.78V23ZM23.0922 23H24.8904L26.5481 17.294H26.6163L28.2782 23H30.0765L32.5737 14.2727H30.5581L29.1135 20.3494H29.0368L27.4473 14.2727H25.7214L24.1277 20.3366H24.0552L22.6106 14.2727H20.595L23.0922 23Z",fill:"#161719",stroke:"none"}),v.createElement("path",{d:"M49.6289 10.667L50.4392 12.8567L52.6289 13.667L50.4392 14.4773L49.6289 16.667L48.8186 14.4773L46.6289 13.667L48.8186 12.8567L49.6289 10.667Z",fill:"white",stroke:"none"}),v.createElement("path",{d:"M44.9668 0L46.3173 3.64955L49.9668 5L46.3173 6.35045L44.9668 10L43.6163 6.35045L39.9668 5L43.6163 3.64955L44.9668 0Z",fill:"white",stroke:"none"}),v.createElement("defs",null,v.createElement("linearGradient",{id:"paint0_linear_1156_21646",x1:"2.75671e-07",y1:"19",x2:"37",y2:"19",gradientUnits:"userSpaceOnUse"},v.createElement("stop",{stopColor:"#FBEFB7"}),v.createElement("stop",{offset:"1",stopColor:"#F9C7C7"})))),oe=B.UI.Node.make((({state:e,notify:t})=>v.createElement(k.F.Fragment,null,e.pipe(d.U((({show:e})=>v.createElement($.J,{mainContent:v.createElement(ne,null),isOutsideReferenceElement:!1,backgroundTheme:"darkDS",placement:"bottom",show:e,onClose:()=>t({kind:"toggle",show:!1})(),headerContent:v.createElement(ie,{className:te.badge}),closeButton:e=>v.createElement(D.Tertiary,{name:"close",theme:"dark",compact:!0,onClick:()=>e()},v.createElement(W.JO.Close,null)),includeMainContentPadding:!1,style:{zIndex:1e3}},v.createElement(ee,{name:"hint",compact:!0,onClick:()=>{t({kind:"toggle",show:!e})()}},v.createElement(W.JO.QuestionMark,{width:12})))))))));function se(e){return B.Z.fromSideEffect((t=>{e.actions.next({kind:q.Kind.setHintPopup,popupKind:t.show?J.some("compactPanelHint"):J.none})}),e.state.pipe(d.U((({visiblePopup:e})=>({show:(0,i.zG)(e,J.fold((()=>!1),(e=>"compactPanelHint"===e)))})))))}var ae=n(98499);const re=({onChange:e,labelId:t,className:n,switchClassName:o,labelClassName:s,checked:a,children:r,disabled:l,dataGrammarlyPart:d="ui-kit-switch",tabIndex:c=0,labelPlacement:h="before"})=>{const[u,p]=v.useState(null!=a&&a);v.useEffect((()=>{p(Boolean(a))}),[a]);const m=t=>{t.preventDefault(),t.stopPropagation(),p(!u),null==e||e(!u)};return v.createElement("div",{"data-grammarly-part":d,...(0,P.Sh)(ae.switchContainer,n,"after"===h?ae.switchContainerCompact:null)},v.createElement("div",{...(0,P.Sh)(ae.switch,o,u?ae.switchChecked:null,l?ae.switchDisabled:null,"before"===h?ae.switchAfter:null),role:"checkbox","aria-checked":u,tabIndex:c,"aria-labelledby":t,onKeyDown:e=>{l||" "!==e.key||m(e)},onClick:l?i.Q1:m},u?"ON":"OFF"),v.createElement("label",{id:t,onClick:l?i.Q1:m,className:s},r))};var le=n(88685);const de=B.UI.Node.make((({state:e,notify:t})=>v.createElement(k.F.Fragment,null,e.pipe(d.U((({inlineHighlightsEnabled:e})=>v.createElement(re,{key:"inline-highlights-switch",labelId:"inline-highlights-switch-label",labelPlacement:"before",labelClassName:le.label,checked:e,onChange:e=>{t({kind:"toggleInlineHighlights",enabled:e})()}},"Highlights")))))));function ce(e){return B.Z.fromSideEffect((t=>{e.actions.next({kind:q.Kind.toggleInlineHighlights,enabled:t.enabled})}),e.state.pipe(d.U((({inlineHighlightsEnabled:e})=>({inlineHighlightsEnabled:e})))))}var he=n(18208);const ue=B.UI.Grid.make((({state:e,slots:t,notify:n})=>v.createElement(k.F.Fragment,null,e.pipe(d.U((({followUpsCount:e,keyPointsCount:i,popupState:{showFollowups:o,showKeyPoints:s,showAll:a}})=>v.createElement(v.Fragment,null,e?v.createElement($.J,{mainContent:t.followUps,isOutsideReferenceElement:!1,backgroundTheme:"light",placement:"bottom",show:o,style:{zIndex:1e3}},v.createElement(ee,{name:"follow-ups",onClick:()=>{n({kind:"buttonClicked",popupKind:o?J.none:J.some("followUps")})()}},e," ",he._6(e,Z.followUps.buttonTitle.singular,Z.followUps.buttonTitle.plural))):null,i?v.createElement($.J,{mainContent:t.keyPoints,isOutsideReferenceElement:!1,backgroundTheme:"light",placement:"bottom",show:s,style:{zIndex:1e3}},v.createElement(ee,{name:"key-points",onClick:()=>{n({kind:"buttonClicked",popupKind:s?J.none:J.some("keyPoints")})()}},i," ",he._6(i,Z.keyPoints.buttonTitle.singular,Z.keyPoints.buttonTitle.plural))):null,e&&i?v.createElement($.J,{mainContent:t.all,isOutsideReferenceElement:!1,backgroundTheme:"light",placement:"bottom",show:a,style:{zIndex:1e3}},v.createElement(ee,{name:"all",onClick:()=>{n({kind:"buttonClicked",popupKind:a?J.none:J.some("allData")})()}},Z.all.buttonTitle)):null))))))),pe=B.UI.Knot.make(ue,{followUps:B.UI.Node.make((()=>v.createElement(v.Fragment,null,"FollowUps content"))),keyPoints:B.UI.Node.make((()=>v.createElement(v.Fragment,null,"Key points content"))),all:B.UI.Node.make((()=>v.createElement(v.Fragment,null,"All content")))});function me(e){return B.Z.composeKnot({root:B.Z.fromSideEffect((t=>{e.actions.next({kind:q.Kind.setCompactPanelMoreDataPopup,popupKind:t.popupKind})}),e.state.pipe(d.U((({followUpsCount:e,keyPointsCount:t,visiblePopup:n})=>({followUpsCount:e,keyPointsCount:t,popupState:(0,i.zG)(n,J.fold((()=>({showFollowups:!1,showKeyPoints:!1,showAll:!1})),(e=>({showFollowups:"followUps"===e,showKeyPoints:"keyPoints"===e,showAll:"allData"===e}))))}))))),followUps:()=>g.of(null),keyPoints:()=>g.of(null),all:()=>g.of(null)})}var ge,fe=n(90361),be=n(53755);!function(e){e.Hide=({className:e,width:t=24})=>v.createElement(W.a1,{className:e,width:t,viewBox:"0 0 24 24"},v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.49205 10.5522C4.73941 10.4295 5.03944 10.5305 5.16218 10.7779C7.91042 16.3166 16.0896 16.3166 18.8378 10.7779C18.9606 10.5305 19.2606 10.4295 19.508 10.5522C19.7553 10.675 19.8563 10.975 19.7336 11.2223C16.6178 17.5018 7.38215 17.5018 4.26639 11.2223C4.14365 10.975 4.24468 10.675 4.49205 10.5522ZM5.06784 13.8847C5.2631 14.0799 5.2631 14.3965 5.06784 14.5918L3.85355 15.806C3.65829 16.0013 3.34171 16.0013 3.14645 15.806C2.95118 15.6108 2.95118 15.2942 3.14645 15.0989L4.36073 13.8847C4.55599 13.6894 4.87258 13.6894 5.06784 13.8847ZM18.9322 13.8847C19.1274 13.6894 19.444 13.6894 19.6393 13.8847L20.8536 15.0989C21.0488 15.2942 21.0488 15.6108 20.8536 15.806C20.6583 16.0013 20.3417 16.0013 20.1464 15.806L18.9322 14.5918C18.7369 14.3965 18.7369 14.0799 18.9322 13.8847ZM8.17599 16.2196C8.42298 16.3431 8.52309 16.6434 8.39959 16.8904L7.59007 18.5094C7.46658 18.7564 7.16624 18.8565 6.91925 18.733C6.67226 18.6095 6.57215 18.3092 6.69564 18.0622L7.50517 16.4432C7.62866 16.1962 7.929 16.0961 8.17599 16.2196ZM15.824 16.2196C16.071 16.0961 16.3713 16.1962 16.4948 16.4432L17.3044 18.0622C17.4279 18.3092 17.3277 18.6095 17.0807 18.733C16.8338 18.8565 16.5334 18.7564 16.4099 18.5094L15.6004 16.8904C15.4769 16.6434 15.577 16.3431 15.824 16.2196ZM12 16.9763C12.2762 16.9763 12.5 17.2001 12.5 17.4763V19.0953C12.5 19.3715 12.2762 19.5953 12 19.5953C11.7239 19.5953 11.5 19.3715 11.5 19.0953V17.4763C11.5 17.2001 11.7239 16.9763 12 16.9763Z",fill:"inherit",stroke:"none"})),e.Info=({className:e,width:t=24})=>v.createElement(W.a1,{className:e,width:t,viewBox:"0 0 24 24"},v.createElement("path",{d:"M12.5,11.273C12.5,10.997 12.276,10.773 12,10.773C11.724,10.773 11.5,10.997 11.5,11.273L11.5,15.636C11.5,15.913 11.724,16.136 12,16.136C12.276,16.136 12.5,15.913 12.5,15.636L12.5,11.273ZM12.5,8.349C12.5,8.073 12.276,7.849 12,7.849C11.724,7.849 11.5,8.073 11.5,8.349L11.5,8.364C11.5,8.64 11.724,8.864 12,8.864C12.276,8.864 12.5,8.64 12.5,8.364L12.5,8.349ZM20,12C20,7.582 16.418,4 12,4C7.582,4 4,7.582 4,12C4,16.418 7.582,20 12,20C16.418,20 20,16.418 20,12ZM19,12C19,15.866 15.866,19 12,19C8.134,19 5,15.866 5,12C5,8.134 8.134,5 12,5C15.866,5 19,8.134 19,12Z",fill:"inherit",stroke:"none",fillRule:"evenodd"})),e.Feedback=({className:e,width:t=24})=>v.createElement(W.a1,{className:e,width:t,viewBox:"0 0 24 24"},v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.5 8C3.5 6.61929 4.61929 5.5 6 5.5H18C19.3807 5.5 20.5 6.61929 20.5 8V14.3429C20.5 15.7236 19.3807 16.8429 18 16.8429H10.3884L6.16667 19.9979V16.8429H6C4.61929 16.8429 3.5 15.7236 3.5 14.3429V8ZM6 6.5C5.17157 6.5 4.5 7.17157 4.5 8V14.3429C4.5 15.1713 5.17157 15.8429 6 15.8429H7.16667V18.0021L10.056 15.8429H18C18.8284 15.8429 19.5 15.1713 19.5 14.3429V8C19.5 7.17157 18.8284 6.5 18 6.5H6ZM17 10H7V9H17V10ZM17 13H7V12H17V13Z",fill:"inherit",stroke:"none"})),e.Disable=({className:e,width:t=24})=>v.createElement(W.a1,{className:e,width:t,viewBox:"0 0 24 24"},v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4.30078C12.2761 4.30078 12.5 4.52464 12.5 4.80078V11.9085C12.5 12.1846 12.2761 12.4085 12 12.4085C11.7239 12.4085 11.5 12.1846 11.5 11.9085V4.80078C11.5 4.52464 11.7239 4.30078 12 4.30078ZM9.43113 6.37798C9.57099 6.61608 9.49134 6.92248 9.25323 7.06234C7.60863 8.02833 6.5 9.83543 6.5 11.9085C6.5 15.0042 8.9696 17.5008 12 17.5008C15.0304 17.5008 17.5 15.0042 17.5 11.9085C17.5 9.83543 16.3914 8.02833 14.7468 7.06234C14.5087 6.92248 14.429 6.61608 14.5689 6.37798C14.7087 6.13987 15.0151 6.06022 15.2532 6.20008C17.1954 7.34087 18.5 9.47149 18.5 11.9085C18.5 15.5421 15.597 18.5008 12 18.5008C8.40298 18.5008 5.5 15.5421 5.5 11.9085C5.5 9.47149 6.80456 7.34087 8.74677 6.20008C8.98487 6.06022 9.29127 6.13987 9.43113 6.37798Z",fill:"inherit",stroke:"none"}))}(ge||(ge={}));const _e=B.UI.Node.make((({notify:e})=>v.createElement("div",{role:"menu"},v.createElement("div",{role:"menuitem",className:be.menuItem,onClick:e({kind:"hide"})},v.createElement(ge.Hide,null),Z.settingsMenu.hide),v.createElement("div",{role:"menuitem",className:be.menuItem,onClick:e({kind:"about"})},v.createElement(ge.Info,null),Z.settingsMenu.about),v.createElement("div",{role:"menuitem",className:be.menuItem,onClick:e({kind:"feedback"})},v.createElement(ge.Feedback,null),Z.settingsMenu.feedback),v.createElement("hr",{className:be.divider}),v.createElement("div",{role:"menuitem",className:be.menuItem,onClick:e({kind:"disable"})},v.createElement(ge.Disable,null),Z.settingsMenu.disable))));function ve(e){return B.Z.fromSideEffect((t=>{switch(t.kind){case"hide":e.actions.next({kind:q.Kind.hideCompactPanel});break;case"about":e.actions.next({kind:q.Kind.requestAbout});break;case"feedback":e.actions.next({kind:q.Kind.requestFeedback});break;case"disable":e.actions.next({kind:q.Kind.disable});break;default:(0,fe.vE)(t)}}),g.of(null))}var we=n(35245);const ye=B.UI.Grid.make((({state:e,slots:t,notify:n})=>v.createElement(k.F.Fragment,null,e.pipe(d.U((({show:e})=>v.createElement($.J,{mainContent:t.menu,isOutsideReferenceElement:!1,backgroundTheme:"light",placement:"bottom-end",showArrow:!1,show:e,style:{zIndex:1e3},distanceFromReferenceElement:0,includeMainContentPadding:!1},v.createElement(ee,{title:"Menu",ariaLabel:"Menu",name:"menu-button",compact:!0,onClick:n({kind:"toggle",show:!e})},v.createElement(W.JO.EllipsisSmall,{className:we.ellipsis}))))))))),Ee=B.UI.Knot.make(ye,{menu:_e});function Ce(e){return B.Z.composeKnot({root:B.Z.fromSideEffect((t=>{e.actions.next({kind:q.Kind.toggleSettingsMenu,show:t.show})}),e.state.pipe(d.U((({visiblePopup:e})=>({show:(0,i.zG)(e,J.fold((()=>!1),(e=>"settingsMenu"===e)))}))))),menu:ve(e)})}const xe=B.UI.Grid.make((({state:e,slots:t})=>v.createElement(k.F.Fragment,null,e.pipe(d.U((({messageId:e})=>v.createElement("div",{key:`compact-panel-${e}`,className:O.compactPanel},v.createElement(j.K,{size:22,className:O.logo}),t.moreDataEntryPoint,t.hintButton,v.createElement("aside",{className:O.aside},t.highlightsSwitch,t.settingsMenu)))))))),Ie=B.UI.Knot.make(xe,{highlightsSwitch:de,moreDataEntryPoint:pe,settingsMenu:Ee,hintButton:oe});var ke=n(65711);const Se=B.UI.Node.make((({state:e})=>v.createElement(k.F.Fragment,null,e.pipe(d.U((({messageId:e})=>v.createElement("div",{key:e,className:ke.replyPanel},"Reader Reply Panel for message ",e)))))));var Me,Pe,Ne=n(14601),Ae=n(32952),He=n(38983);class Ue{constructor(e,t){this._readerCSState=t,this._subscriptions=new Ne.w,this.actions=new Ae.xQ,this._state=He.h.create(e),this.state=this._state.view(),this._subscriptions.add(this._handleSettingsMenuToggle()),this._subscriptions.add(this._handleSetMoreDataPopupKind()),this._subscriptions.add(this._handleInlineHighlightsToggle()),this._subscriptions.add(this._handleHintPopupKind()),this._subscriptions.add(this._readerCSState.pipe(u.b((e=>this._state.modify((t=>({...t,inlineHighlightsEnabled:Boolean(e.inlineHighlightsEnabled)})))))).subscribe())}dispose(){this._subscriptions.unsubscribe()}_handleSettingsMenuToggle(){return this.actions.pipe(Y.ofType(q.Kind.toggleSettingsMenu)).subscribe((({show:e})=>{this._state.modify((t=>({...t,visiblePopup:e?J.some("settingsMenu"):J.none})))}))}_handleSetMoreDataPopupKind(){return this.actions.pipe(Y.ofType(q.Kind.setCompactPanelMoreDataPopup)).subscribe((({popupKind:e})=>{this._state.modify((t=>({...t,visiblePopup:e})))}))}_handleHintPopupKind(){return this.actions.pipe(Y.ofType(q.Kind.setHintPopup)).subscribe((({popupKind:e})=>{this._state.modify((t=>({...t,visiblePopup:e})))}))}_handleInlineHighlightsToggle(){return this.actions.pipe(Y.ofType(q.Kind.toggleInlineHighlights)).subscribe((()=>{}))}}!function(e){e.Mock=class{constructor(e){this._subscriptions=new Ne.w,this._state=He.h.create({messageId:"message-100500",inlineHighlightsEnabled:!0,followUpsCount:10,keyPointsCount:5,visiblePopup:J.none}),this.state=this._state.view(),this.actions=new Ae.xQ,this._state.modify((()=>e)),this._subscriptions.add(this._handleSettingsMenuToggle()),this._subscriptions.add(this._handleSetMoreDataPopupKind()),this._subscriptions.add(this._handleHintPopupKind())}_handleSettingsMenuToggle(){return this.actions.pipe(Y.ofType(q.Kind.toggleSettingsMenu)).subscribe((({show:e})=>{this._state.modify((t=>({...t,visiblePopup:e?J.some("settingsMenu"):J.none})))}))}_handleSetMoreDataPopupKind(){return this.actions.pipe(Y.ofType(q.Kind.setCompactPanelMoreDataPopup)).subscribe((({popupKind:e})=>{this._state.modify((t=>({...t,visiblePopup:e})))}))}_handleHintPopupKind(){return this.actions.pipe(Y.ofType(q.Kind.setHintPopup)).subscribe((({popupKind:e})=>{this._state.modify((t=>({...t,visiblePopup:e})))}))}dispose(){this._subscriptions.unsubscribe()}}}(Me||(Me={}));class Fe{constructor(e){this._state=He.h.create(e),this.state=this._state.view()}dispose(){}}!function(e){e.Mock=class{constructor(){this._state=He.h.create({messageId:"message-100500"}),this.state=this._state.view()}dispose(){}}}(Pe||(Pe={}));var ze=n(33254),Te=n(63551),Le=n(29567),Re=n(60797),Ge=n(23063),De=n(12126),je=n(95195),Be=n(55421),Oe=n(30625),Ke=n(25691);class Ve{constructor(e=s.Y.create("gmail.reader.cardController")){this._logger=e,this._hovered=new Ae.xQ,this._dismissed=new Ae.xQ,this.cardHovered=this._hovered.pipe(m.O(!1),I.x()),this.cardDismissed=this._dismissed.pipe(I.x()),this._activeCardModel=He.h.create(null),this.view=this._activeCardModel.pipe(d.U((e=>(null==e?void 0:e.annotation)?v.createElement(Ke.W,{anchorRect:e.highlightRect},v.createElement("div",{style:{background:"white",borderRadius:10,padding:10,fontSize:"12px",fontFamily:"sans-serif",boxShadow:"0px 2px 10px rgba(0, 0, 0, 0.6)"}},v.createElement("b",null,"Annotation"),v.createElement("pre",{style:{maxWidth:400,whiteSpace:"pre-wrap"}},JSON.stringify(e.annotation,null,4)))):null))),this._logger.debug("Created")}show(e,t,n){this._activeCardModel.set({annotation:e,highlightRect:t})}hide(){this._activeCardModel.set(null),this._hovered.next(!1)}dispose(){this.hide()}}var Ze=n(17771),qe=n(26328),Ye=n(64015),Qe=n(48044);var $e=n(96002),We=n(18505),Je=n(2780),Xe=n(83078);class et{constructor(e,t,n,a,r=s.Y.create("gmail.reader.panelInjectionV1")){this._logger=r,this._subs=new Ne.w,this._compactInjections=new Map,this._replyFormInjections=new Map,this._subs.add(e.pipe(Q.h((e=>e.added.size>0||e.updated.size>0||e.removed.size>0)),u.b((({added:e,updated:t,removed:s,messages:a})=>{t.forEach((e=>{var t;null===(t=this._compactInjections.get(e))||void 0===t||t.dispose(),this._compactInjections.delete(e),this._logger.trace("Compact panel disposed: message updated")})),s.forEach((e=>{var t;null===(t=this._compactInjections.get(e))||void 0===t||t.dispose(),this._compactInjections.delete(e),this._logger.trace("Compact panel disposed: message removed")}));for(const s of a.values())(0,i.zG)(s,J.fromPredicate((n=>e.has(n.id)||t.has(n.id))),J.map((e=>e.bodyNode)),J.chain((e=>{var t;return J.fromNullable(null===(t=e.node.parentElement)||void 0===t?void 0:t.parentElement)})),J.filter((e=>e instanceof HTMLElement)),J.chain((e=>Ze.Y(J.option)({injectBefore:(0,i.zG)(J.fromNullable(e.firstElementChild),J.filter((e=>e instanceof HTMLElement))),injectionParent:J.some(e)}))),J.map((({injectBefore:e,injectionParent:t})=>{const i=n(s.id),a=We.VB.get({monitorAs:"reader-compact-panel"}).inject(Je.EM.fromDocument(e.ownerDocument,"grammarly-extension"),(n=>t.insertBefore(n,e)),(()=>v.createElement(y.L,{chunkName:"readerGmailV1ThreadIntegration"},v.createElement($e.p,{env:(0,o.O)()},v.createElement("div",null,v.createElement(i,null))))));this._compactInjections.set(s.id,a),this._logger.trace("Compact panel injected")})))}))).subscribe()),this._subs.add(t.pipe(Q.h((e=>e.added.size>0||e.updated.size>0||e.removed.size>0)),u.b((({added:e,updated:t,removed:n,forms:s})=>{t.forEach((e=>{var t;null===(t=this._replyFormInjections.get(e))||void 0===t||t.dispose(),this._replyFormInjections.delete(e),this._logger.trace("Reply panel disposed: form updated")})),n.forEach((e=>{var t;null===(t=this._replyFormInjections.get(e))||void 0===t||t.dispose(),this._replyFormInjections.delete(e),this._logger.trace("Reply panel disposed: form removed")}));for(const n of s.values())(0,i.zG)(n,J.fromPredicate((({messageId:n})=>e.has(n)||t.has(n))),J.chain((({formEl:e,messageId:t})=>Ze.Y(J.option)({tr:J.fromNullable(e.closest("tr")),messageId:J.some(t)}))),J.chain((({tr:e,messageId:t})=>{var n;return Ze.Y(J.option)({firstTd:(0,i.zG)(J.fromNullable(e.firstElementChild),J.filter((e=>e instanceof HTMLTableCellElement))),secondTd:(0,i.zG)(J.fromNullable(null===(n=e.firstElementChild)||void 0===n?void 0:n.nextElementSibling),J.filter((e=>e instanceof HTMLTableCellElement))),tr:J.some(e),table:J.fromNullable(e.closest("tbody")),messageId:J.some(t)})})),Xe.bw((({firstTd:e,secondTd:t,tr:n,table:i,messageId:s})=>{const r=i.ownerDocument,l=r.createElement("tr");e.setAttribute("rowSpan","2"),i.insertBefore(l,n),l.appendChild(e);const d=r.createElement("td");l.appendChild(d);const c=a(s),h=We.VB.get({monitorAs:"reader-reply-panel"}).inject(Je.EM.fromDocument(i.ownerDocument,"grammarly-extension"),Je.zs.appendChild(d),(()=>v.createElement(y.L,{chunkName:"readerGmailV1ThreadIntegration"},v.createElement($e.p,{env:(0,o.O)()},v.createElement("div",{style:{marginBottom:"0.5rem"}},v.createElement(c,null))))));this._compactInjections.set(s,{dispose:()=>{h.dispose(),e.removeAttribute("rowSpan"),n.insertBefore(e,t),i.removeChild(l)}}),this._logger.trace("Reply panel injected")})))}))).subscribe())}dispose(){this._subs.unsubscribe();for(const e of this._compactInjections.values())e.dispose(),this._logger.trace("Compact panel disposed");for(const e of this._replyFormInjections.values())e.dispose(),this._logger.trace("Reply panel disposed")}}var tt=n(48424),nt=n(97757),it=n(88522),ot=n(67434),st=n(44212),at=n(78146),rt=n(85321),lt=n(40151),dt=n(8125),ct=n(70631),ht=n(71249),ut=n(73975),pt=n(44126),mt=n(55415);function gt(e){return mt.CE(e,"updateContextInfoId","kind")}function ft(e){return mt.CE(e,"updateContextInfoId")}class bt{constructor(e,t,n,o=s.Y.create("gmail.reader.remoteData")){this._checkingService=e,this._threadContext=t,this._logger=o,this._subscriptions=new Ne.w,this._docInfo=He.h.create(new Map),this._summaries=He.h.create(new Map),this._annotations=He.h.create(new Map),this._pendingUpdates=He.h.create(new Map),this._errors=He.h.create(new Map),this.docInfo=this._docInfo.view(),this.summaries=this._summaries.view(),this.annotations=this._annotations.view(),this.pendingUpdates=this._pendingUpdates.view(),this.errors=this._errors.view(),this._subscriptions.add(this._threadContext.view((e=>new Set(e.messageIndexToIdMap.values()))).pipe((0,nt.Gx)(n),ot.R(((e,t)=>new Set(Array.from(e).concat(Array.from(t)))),new Set),(0,Oe.Yp)(ut.yv),(0,pt.c)(this._threadContext),st.u(),at.v(i.yR),rt.zg((e=>e.pipe(c.w((e=>this._updateContextInfoAndGetChecks(e).pipe(u.b((e=>this._logger.debug("Received message",e))),ot.R(((e,t)=>[...e,t]),[]),d.U(qe.nI),Re.oA,u.b((t=>this._updateChecksState(e,t)))))))))).subscribe())}_updateChecksState(e,t){const n=t[0].updateContextInfoId,o=!!t.find(S.j.isUpdateContextInfoFinished);(0,i.zG)(t,ht.Ew(S.j.Reader.isDocInfo),Xe.bw((t=>this._docInfo.modify((n=>{return new Map(n).set(e,(i=t,mt.CE(i,"kind")));var i})))));const s=t.filter(S.j.Reader.isDocAnnotation);(0,i.zG)(qe.nI(s),J.alt((()=>o?J.some(s):J.none)),Xe.bw((t=>this._annotations.modify((i=>new Map(i).set(e,{updateContextInfoId:n,annotations:t.map(ft)}))))));const a=(0,i.zG)(t,ht.hX(S.j.Reader.isSummaryItem),ht.u4(new Map,((e,t)=>e.set(t.id,t))));(0,i.zG)(t,ht.Ew(S.j.Reader.isSummaryFinished),J.map((e=>(0,i.zG)(e.summaryItems,ht.UI((e=>J.fromNullable(a.get(e)))),ht.oA,ht.UI(gt)))),Xe.bw((t=>this._summaries.modify((i=>new Map(i).set(e,{updateContextInfoId:n,items:t}))))))}_updateContextInfoAndGetChecks(e){return(0,i.zG)(function(e,t){return(0,i.zG)(je.ij(new tt.P(`message ${e} is not expanded`))(t.expandedMessages.get(e)),je.tS((t=>ct.d6(t)?je.F2(t.value):je.t$(new tt.P(ct.IR(t)?t.error.message:`message ${e} not extracted`)))),je.tS((e=>Ze.Y(je.wE)({containerType:je.F2("email"),docid:je.F2(e.id),title:t.subject,delta:je.F2((new it.i).insert(e.textMap.getPlainText())),siblingIndex:je.F2(e.index),authors:(0,i.zG)(t.loggedUser,je.UI((t=>[{email:e.context.author.email,name:e.context.author.name,currentSessionUser:e.context.author.email===t.email}]))),audience:(0,i.zG)(t.loggedUser,je.UI((t=>e.context.audience.map((e=>({email:e.email,name:e.email,currentSessionUser:e.email===t.email}))))),je.tS((e=>Ze.Y(je.wE)({recipients:je.F2(e),channelId:t.threadId,channelName:t.subject})))),metadata:je.F2([e.context.metadata])}))))}(e,this._threadContext.get()),je.g_((t=>(this._errors.modify((n=>new Map(n).set(e,t))),this._logger.warn(`Extraction error for ${e}`,t),lt.E)),(t=>(this._errors.modify((t=>(0,i.zG)(new Map(t),(t=>(t.delete(e),t))))),this._logger.info(`Getting checks for ${e}`),De.D(this._checkingService.get().updateContextInfo(t))))),c.w(je.g_((t=>(this._errors.modify((n=>new Map(n).set(e,t))),this._logger.warn(`updateContextInfo error for ${e}`,t),lt.E)),(t=>(this._pendingUpdates.modify((n=>new Map(n).set(e,t))),this._checkingService.get().messages.pipe(Q.h((0,dt.W9)((0,dt.Kg)(S.j.isReader,S.j.isUpdateContextInfoFinished),(e=>e.updateContextInfoId===t)))))))))}dispose(){this._subscriptions.unsubscribe()}}function _t(e,t,n,a,r,l,h,p,m,b=o.O,v=s.Y.create("gmail.reader.threadIntegrationV1")){const w=fe.iy.create(),y=(0,fe.Vo)((()=>b().bgRpc.api)),E=new Map,C=new Map,x=new Map,I=e=>t=>{const n=`${e} promise rejection: ${String(t)}`;v.error(n),m.readerGmail.warning("promiseRejection",n,t)},k=e=>(0,i.zG)(J.fromNullable(E.get(e)),J.getOrElse((()=>{const t=new Ue({messageId:e,inlineHighlightsEnabled:!0,followUpsCount:0,keyPointsCount:0,visiblePopup:J.none},l);return E.set(e,t),C.set(e,function(e,t,n){const i=new Ne.w;return i.add(e.pipe(Q.h(q.is(q.Kind.toggleInlineHighlights))).subscribe((({enabled:e})=>{t.toggleReaderInlineHighlights(e).catch(n("CSActions.toggleReaderInlineHighlights"))}))),i}(t.actions,h,I)),t}))),S=g.of(!0),M=new bt(e,n,S),P=He.h.create(null),N=l.view((({inlineHighlightsEnabled:e})=>{P.modify((o=>(null==o||o.dispose(),!1===e||r?null:new Te.u(function(e,t,n){return f.aj([e.annotations,e.docInfo,t,n]).pipe(d.U((([e,t,n,o])=>(0,i.zG)(e,Qe.Su(((e,s)=>(0,i.zG)(Ze.Y(J.option)({annotations:(0,i.zG)(J.fromNullable(t.get(e)),J.chain((e=>(0,i.zG)(s.annotations,Ye.hX((()=>J.isNone(e.filtered)||o)),qe.nI)))),message:(0,i.zG)(J.fromNullable(n.expandedMessages.get(e)),J.chain(Oe.zk))}),J.map((({annotations:e,message:t})=>({docId:t.id,textMap:t.textMap,textNode:t.bodyNode.node,annotations:e})))))),Qe.DZ(i.yR)))))}(M,n,He.h.create(!1)),t,((e,t)=>new ze.j(e,t,(()=>new Ve),((e,t,n,i)=>new G(e,t,n,i)),(e=>new _(e)),!1)),((e,t)=>({highlightId:e,annotation:t,highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null}))))))})).subscribe(),A=r?null:new et(a,(0,Be._)(t),(e=>()=>{return B.UI.mount(Ie,(t=k(e),B.Z.composeKnot({root:()=>t.state,highlightsSwitch:ce(t),moreDataEntryPoint:me(t),settingsMenu:Ce(t),hintButton:se(t)})));var t}),(e=>()=>{return B.UI.mount(Se,(t=(e=>(0,i.zG)(J.fromNullable(x.get(e)),J.getOrElse((()=>{const t=new Fe({messageId:e});return x.set(e,t),t}))))(e),()=>t.state));var t})),H=n.pipe(d.U((e=>(0,i.zG)(J.fromNullable(e.messageIndexToIdMap.get(e.messageCount-1)),J.chain((t=>J.fromNullable(e.expandedMessages.get(t)))),J.chain(Oe.zk),J.map((t=>({lastMessage:t,ctx:e})))))),Re.oA,Ge.q(1),c.w((({lastMessage:e,ctx:t})=>De.D((0,Le.j)(e.context.author.email,e.context.audience.map((e=>e.email)),(e=>y.get().isGenericEmailDomain(e)))).pipe(d.U((n=>({lastMessage:e,ctx:t,isExternalComm:n})))))),u.b((({lastMessage:e,ctx:t,isExternalComm:n})=>{p.readerMailSessionStart(e.id,e.context.audience.length,(0,Oe.Y2)(e.textMap.getPlainText()),t.messageCount,w,(0,i.zG)(J.fromEither(n),J.flatten,J.toUndefined),(0,i.zG)(t.threadId,J.fromEither,J.toUndefined))}))).subscribe();return v.debug(`Thread integration created for thread #${je.fS((()=>"unknown"))(n.get().threadId)}`),()=>{var e;p.readerMailSessionEnd(w,(0,i.zG)(n.get().threadId,J.fromEither,J.toUndefined)),M.dispose(),Array.from(E.values()).forEach((e=>e.dispose())),E.clear(),Array.from(C.values()).forEach((e=>e.unsubscribe())),C.clear(),Array.from(x.values()).forEach((e=>e.dispose())),x.clear(),null==A||A.dispose(),N.unsubscribe(),null===(e=P.get())||void 0===e||e.dispose(),H.unsubscribe(),v.debug("Thread integration disposed")}}},96002:(e,t,n)=>{n.d(t,{p:()=>g});var i=n(27378),o=n(86620),s=n(92132),a=n(87965),r=n(48189),l=n(50663),d=n(49468),c=n(33678),h=n(15073),u=n(42103),p=n(64078),m=n(76974);const g=({env:e,children:t,className:n})=>i.createElement(d.o,{className:n},i.createElement(a.p,null,i.createElement(c.a.Context.Provider,{value:new o.C(e)},i.createElement(s.Q,{remSize:m.of(16),setter:e=>h.u.setRootCssVar(document.documentElement,e)},i.createElement(u.G.DefaultProvider,null,t,i.createElement(r.p,{regular:!0,bold:!0}),i.createElement(l.G,null),i.createElement(p.X,null))))))},86620:(e,t,n)=>{n.d(t,{C:()=>d,U:()=>i});var i,o=n(27378),s=n(29511),a=n(33678),r=n(88056),l=n(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...a.a.Flag},e.Context=o.createContext(r.Y.invariantContent("Environment"))}(i||(i={}));class d{constructor(e=(0,s.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(i.Flag.isAppleSystem),this._flags.add(i.Flag.supportsSVGDominantBaseline),this._flags.add(i.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},92132:(e,t,n)=>{n.d(t,{Q:()=>l});var i=n(27378),o=n(15073),s=n(60797),a=n(95300),r=n(5114);const l=({children:e,remSize:t,setter:n})=>(d+=1,i.useEffect((()=>{const e=t.subscribe((e=>{c.next(r.some(e)),n(r.some(e))}));return()=>{e.unsubscribe(),d-=1,0===d&&(c.next(r.none),n(r.none))}}),[t]),i.createElement(o.u.Context.Provider,{value:c.pipe(s.oA)},e));let d=0;const c=new a.X(r.none)},33254:(e,t,n)=>{n.d(t,{j:()=>J});var i=n(77176),o=n(34311);class s{constructor(e){this._annotationsStateService=e}getHoveredStateBehavior(e){return this._annotationsStateService.getHighlightedAnnotation().pipe((0,i.U)((t=>t&&t.highlightIds.includes(e)?o.pc.hovered:o.pc.none)))}}var a=n(74850),r=n(19751),l=n(66310),d=n(24209),c=n(2834),h=n(50628),u=n(93508),p=n(76974),m=n(24755),g=n(95300),f=n(95343),b=n(47849);class _ extends b.L{constructor(e,t=a.Y.create(_.name)){super(e,t)}getActiveAnnotation(){return this.getHighlightedAnnotation().pipe(r.skipBy(b.C.getEq()))}getHighlightedAnnotation(){return this._rawHighlightedAnnotation().pipe(r.skipBy(b.C.getEq()),l.w((e=>e?d.T(this._offByUpdatedGeometry(e),this._offByTextPositionChange()).pipe(c.b((()=>this._log.trace("Active state was overriden by text or geometry change"))),h.P(),u.O(e)):p.of(null))),r.skipBy(b.C.getEq()),m.O(new g.X(null)),f.x())}}var v=n(93356),w=n(76331),y=n(57050),E=n(40327),C=n(10166),x=n(62337),I=n(71249),k=n(4432);class S{constructor(e=!0){this._collateLines=e}create(e,t){return{getRects:()=>{var n;const i=[];let o,s=e.start,a=!1;do{const r=t.getFragmentAtOrBeforeOffset(s);if(r&&o!==s){o=s;if(null===(n=r.node.textContent)||void 0===n?void 0:n.replace(/\s/g,"")){const n=k.M.createRange(t,s,Math.min(r.endOffset,e.end));n&&i.push(...Array.from(n.getClientRects()))}s=r.endOffset===s?r.endOffset+1:r.endOffset}else a=!0}while(s<e.end&&!a);return(0,E.pipe)(i,C.e,this._collateLines?C.y:y.yR,I.UI(x.Pf.create))}}}getClientRects(e){return e.getRects()}getIsInvalid(e){return!1}getIsConsistent(e,t,n){return!0}dispose(e){}}var M=n(13116),P=n(27378),N=n(2844),A=n(28043),H=n(28094),U=n(95981),F=n(63919),z=n(25924),T=n(34379),L=n(18505),R=n(2780),G=n(68383),D=n(92783),j=n(90361),B=n(57356),O=n(51655),K=n(70718),V=n(13822);function Z(e,t,n,i=!1){const o=(0,O.Me)(e).body,s=(0,O.Jj)(e);let a={left:"0px",top:"0px"};if(t.fieldPaintingPositioning===B.Q.nonPositioned&&t.positionedAncestor===o){const e=s.getComputedStyle(o);a={left:e.marginLeft||"0px",top:e.marginRight||"0px"}}else if(t.positionedAncestor!==o){const e=s.getComputedStyle(t.positionedAncestor);a={left:e.borderLeftWidth&&`-${e.borderLeftWidth}`||"0px",top:e.borderTopWidth&&`-${e.borderTopWidth}`||"0px"}}return o=>{o.style.position="absolute",o.style.top=a.top,o.style.left=i?"auto":a.left,o.style.right=i?a.left:"auto",o.style.pointerEvents="none",function({subjectElement:e,isPositioned:t,subjectElementStyle:n,integrationRoot:i,positionedAncestor:o}){t?(i.style.zIndex=n.zIndex,e.insertAdjacentElement("afterend",i)):o.insertAdjacentElement("afterbegin",i)}({subjectElement:e,isPositioned:t.fieldPaintingPositioning===B.Q.positioned,subjectElementStyle:n,integrationRoot:o,positionedAncestor:t.positionedAncestor})}}function q(e){return x.Pf.create({...e.client,...e.size})}class Y{constructor(e){this._highlightsSubject=e,this.getFieldPositionRelativeToViewport=()=>{const e=this._highlightsSubject.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}},this._prepareHighlights=(e,t=(0,O.is)(e))=>{const n=(0,O.o)(e),i=(0,K.fL)(e,!1,n,t);return{layout:i,rootInjector:Z(e,i,n),enableHighlightsBlendingOnRoot:(0,H.$)(e,n)}},this._prepareInnerElements=(e,t=(0,O.is)(e),n)=>{const i=(0,O.o)(e),o=n||(0,K.fL)(e,!1,i,t);return{layout:o,rootInjector:Z(e,o,i,!0)}},this._highlights=this._prepareHighlights(this._highlightsSubject),this._innerElements=this._prepareInnerElements(this._highlightsSubject,void 0,this._highlights.layout),this._win=(0,O.Jj)(this._highlightsSubject),this._createTextNodeRect=e=>({page:F.Cv.fromClient(e.client,{top:this._win.scrollY,left:this._win.scrollX}),offset:e.offset,client:e.client,size:e.size,padding:e.padding}),this.textNode={rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),visibleRect:this._highlights.layout.textField.visibleRect.map(this._createTextNodeRect),scroll:this._highlights.layout.textField.scroll,scrollSize:this._highlights.layout.textField.scrollSize,scroller:(0,T.iX)(this._highlightsSubject,{rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),scrollSize:this._highlights.layout.textField.scrollSize})},this.highlightHeightOffset=0,this.mouse=(0,N.aj)([this._highlights.layout.textField.paddingRect.behavior,this._highlights.layout.textField.scroll.behavior]).pipe((0,i.U)((([e,t])=>({rect:q(e),scroll:t}))),(0,l.w)((({rect:e,scroll:t})=>(0,D.Am)()?(0,z.q7)(this._win,e,t):(0,z.B0)(this._win,e,t))),(0,A.x)(j.fS))}createGeometryLayout(){return new U.D((()=>q(this._highlights.layout.textField.paddingRect.getCurrent())),(()=>this._highlights.layout.textField.scroll.getCurrent()),(()=>q(this._highlights.layout.textField.paddingRect.getApproximate())),(()=>this._highlights.layout.textField.scroll.getApproximate()))}render(e,t){const n={position:"absolute",top:0,left:0},i={position:"absolute",top:0,right:0},o=()=>e.innerElements?P.createElement(e.innerElements,null):null,s=(0,O.Me)(this._highlightsSubject),a=L.VB.get({monitorAs:"highlights"}).inject(R.EM.fromDocument(s,"grammarly-extension"),(e=>{t.highlightsBlendingEnabled&&this._highlights.enableHighlightsBlendingOnRoot(e),this._highlights.rootInjector(e)}),G.G7.showWhenLoaded(P.createElement((()=>P.createElement(P.Fragment,null,e.highlights&&P.createElement("div",{"data-grammarly-part":"highlights",style:n},P.createElement(V.V,{layout:this._highlights.layout},P.createElement("div",{style:n},P.createElement(e.highlights,null)))))),null))),r=L.VB.get({monitorAs:"inner-elements"}).inject(R.EM.fromDocument(s,"grammarly-extension"),this._innerElements.rootInjector,G.G7.showWhenLoaded(P.createElement((()=>e.innerElements?P.createElement("div",{"data-grammarly-part":"inner-elements",style:i},P.createElement(o,null)):null),null))),l=e.outerElements&&L.VB.get({monitorAs:"outer-elements"}).inject(R.EM.fromDocument(s,"grammarly-popups"),R.zs.appendChild(s.documentElement),G.G7.showWhenLoaded(P.createElement(e.outerElements,null)),{eventPropagationHandler:t.eventPropagationHandler});return{dispose:()=>{a&&a.dispose(),l&&l.dispose(),r&&r.dispose()}}}}var Q=n(98403),$=n(14601),W=n(38983);class J{constructor(e,t,n,i,a=(e=>new _(e)),r=!0){this._textNode=e,this._textMap=t,this._collateLines=r,this._subscriptions=new $.w,this._geometryProvider=new S(this._collateLines),this._layout=new Y(this._textNode),this.highlightsCollection=new w.C(this._geometryProvider,this._layout.createGeometryLayout(),(()=>this._textMap),(0,v.u)(),(0,o.WF)(this._layout.textNode));const l=n();this._subscriptions.add((()=>null==l?void 0:l.dispose()));let d=null;if(l){const e=W.h.create(null),t=a({textNode:this._textNode,textNodeLayout:this._layout.textNode,mouseData:this._layout.mouse,highlightGeometry:this.highlightsCollection,cardController:l,getCurrentCardAnnotationState:()=>e.get()});this._subscriptions.add(t.getActiveAnnotation().subscribe(Q.wW(e))),this._subscriptions.add(e.subscribe((e=>{e?l.show(e.annotation,(0,M.Z)(e.activeHighlightRect,this._layout.textNode.rect.getApproximate().client,this._layout.textNode.scroll.getApproximate())):l.hide()}))),d=new s(t)}const c=i(this._layout,this.highlightsCollection,(null==l?void 0:l.view)||p.of(null),(e=>(null==d?void 0:d.getHoveredStateBehavior(e))||p.of(o.pc.none))),h=this._layout.render(c,{});this._subscriptions.add((()=>h.dispose()))}dispose(){this.highlightsCollection.dispose(),this._subscriptions.unsubscribe()}}},63551:(e,t,n)=>{n.d(t,{u:()=>y});var i,o=n(57050),s=n(19723),a=n(34311),r=n(74850),l=n(14601),d=n(32952),c=n(24209),h=n(93508),u=n(16118),p=n(77176),m=n(85321),g=n(73975),f=n(71249),b=n(43675),_=n(92843),v=n(5114),w=n(83078);!function(e){e.eq=g.Uz((e=>({annotations:e.annotations,docId:e.docId,textNode:e.textNode})))(g.MW({docId:g.yv,annotations:f.Eh(s.q.eq),textNode:g.w4}))}(i||(i={}));class y{constructor(e,t,n,g,f=r.Y.create("gmail.annotations.manager")){this._messagesRoot=t,this._logger=f,this._subscriptions=new l.w,this._currentAnnotations=new Map,this._state=new Map,this._textNodeToDocId=new WeakMap,this._annotationIdsForDocId=new Map,this._hiddenDocs=new WeakMap,this._hideActionSubject=new d.xQ,this._intersectionObserver=this._initIntersectionObserver();const y=c.T(e.pipe(h.O(new Map),u.G(),p.U((([e,t])=>(0,o.zG)(b.yi(i.eq)(e,t),_.v.reduce([],((e,{docId:t})=>e.concat({kind:"remove",docId:t})),((e,t,n)=>e.concat({kind:"update",prevAnnotations:t.annotations,...n})),((e,t)=>e.concat({kind:"add",...t})))))),m.zg(o.yR)),this._hideActionSubject);this._subscriptions.add(y.subscribe((e=>{const t=this._state.get(e.docId);if(t&&("update"===e.kind?e.prevAnnotations.forEach((t=>{const n=s.q.Id.create(t.id);this._currentAnnotations.delete(n),(0,o.zG)(v.fromNullable(this._annotationIdsForDocId.get(e.docId)),w.bw((e=>{e.delete(n)})))})):"remove"===e.kind&&((0,o.zG)(v.fromNullable(this._annotationIdsForDocId.get(e.docId)),w.bw((e=>{for(const t of e.values())this._currentAnnotations.delete(t)}))),this._annotationIdsForDocId.delete(e.docId),this._textNodeToDocId.delete(t.message.textNode),this._state.delete(e.docId)),t.disposables.forEach((e=>e.dispose())),this._logger.trace(`Annotations for ${e.docId} cleared`)),"add"===e.kind||"update"===e.kind){const t=n(e.textNode,e.textMap,(e=>v.fromNullable(this._currentAnnotations.get(e))));this._intersectionObserver.observe(e.textNode),this._state.set(e.docId,{message:e,disposables:[t,{dispose:()=>this._intersectionObserver.unobserve(e.textNode)}]}),this._textNodeToDocId.set(e.textNode,e.docId);const i=(0,o.zG)(v.fromNullable(this._annotationIdsForDocId.get(e.docId)),v.getOrElse((()=>{const t=new Set;return this._annotationIdsForDocId.set(e.docId,t),t})));e.annotations.forEach((e=>{const n=a.y$.Id.create(e.id);this._logger.trace("Adding annotation highlight",n),this._currentAnnotations.set(e.id,e),i.add(e.id),t.highlightsCollection.addHighlight(n,{start:e.span.s,end:e.span.e},g(n,e))}))}})))}_initIntersectionObserver(){return new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?(0,o.zG)(v.fromNullable(this._hiddenDocs.get(e.target)),w.bw((t=>{this._hiddenDocs.delete(e.target),this._hideActionSubject.next({kind:"add",...t})}))):(0,o.zG)(v.fromNullable(this._textNodeToDocId.get(e.target)),v.chain((e=>v.fromNullable(this._state.get(e)))),w.bw((({message:t})=>{const{docId:n,textNode:i}=t;this._logger.debug(`Message ${n} hidden, clearing annotations`),this._hideActionSubject.next({kind:"remove",docId:n}),this._hiddenDocs.set(e.target,t),this._intersectionObserver.observe(i)})))}))}),{root:this._messagesRoot})}dispose(){this._subscriptions.unsubscribe();for(const{disposables:e}of this._state.values())e.forEach((e=>e.dispose()));this._currentAnnotations.clear(),this._state.clear(),this._annotationIdsForDocId.clear(),this._intersectionObserver.disconnect()}}},10870:e=>{e.exports={button:"FIxIO",noPadding:"_35b6b",dark:"_2m039",secondary:"_3OqzQ",tertiary:"_11r_m"}},41538:e=>{e.exports={highlight:"aiZOA",background:"_7C5i7",showBackground:"_28ZiA",debug:"Jrxsn",hovered:"_20_UY"}},71359:e=>{e.exports={compactPanel:"_1zozF",logo:"_1pVPD",aside:"_5YrNo"}},38573:e=>{e.exports={hint:"_2XlJW",header:"_3t-_o",content:"_2_rwy",buttons:"_1gerT",badge:"_3EAtg"}},88685:e=>{e.exports={label:"txuuN"}},53755:e=>{e.exports={menuItem:"_vybQ",divider:"_2UC3r"}},35245:e=>{e.exports={ellipsis:"_3w2uq"}},3595:e=>{e.exports={button:"bUKek",noPadding:"_2LwDP"}},65711:e=>{e.exports={replyPanel:"_3LutT"}},98499:e=>{e.exports={switchContainer:"qQhHU",switchContainerCompact:"i_xK_",switch:"_2Ag9O",switchAfter:"O4aPa",switchChecked:"_1x1OX",switchDisabled:"_3i5BY",on_off:"_17N4Q"}}}]);